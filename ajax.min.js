!function(t,e,n){"use strict";!function(t,e){var n=t.define||null;"function"==typeof n&&n.amd?n("ajax",[],function(){return e()}):t.Ajax=e()}(t,function(){var r={URLENCODED:"application/x-www-form-urlencoded",JSON:"application/json"},o=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e}(r),i=function(n){var r=e.createElement("a");return r.href=n,r.hostname===t.location.hostname},a=function(t){var e=new XMLHttpRequest;return"withCredentials"in e?e:i(t)?new ActiveXObject("Msxml2.XMLHTTP"):new XDomainRequest},s=function(){},u=function(t){var e=this;e.xhr=a(t.url),e.url=t.url,e.method=t.method||"GET",e.type=t.type||o[0],e.data=t.data||{},e.token=t.token||e._getToken(),e.timeout=t.timeout||0,e.headers=t.headers||{},["onSuccess","onError","onStart","onFinish","onTimeout"].forEach(function(n){e[n]=t[n]||s})};return u.prototype={init:function(){this._validate(),this._defaultHeaders(),this.xhr.open(this.method,this.url,!0),this.xhr.timeout=this.timeout,this._setRequestHeaders(),this._bindEvents();var t=this.xhr;return this.onStart(t),this.xhr.send(this._parseData())},_bindEvents:function(){var t=this,e=t.xhr;e.ontimeout=t.onTimeout,this._xDomainRequest()?(e.onload=t.onSuccess,e.onerror=t.onError):e.onreadystatechange=function(){var e=this;4===e.readyState&&(e.status.toString().match(/2[0-9]{1,2}/)?t.onSuccess(e):t.onError(e),t.onFinish(e))}},_xDomainRequest:function(){return!!this.xhr.constructor.toString().match("XDomainRequest")},_setRequestHeaders:function(){var t=this;if(!t._xDomainRequest()){var e=t.headers;n.keys(e).forEach(function(n){t.xhr.setRequestHeader(n,e[n])})}},_validate:function(){if(-1===o.indexOf(this.type))throw new Error("Ajax: Invalid type");if(!this.url)throw new Error("Ajax: URL required")},_defaultHeaders:function(){var t=this.headers,e=this.token;t["Content-Type"]=this._contentType(),e&&(t["X-CSRF-Token"]=e)},_contentType:function(){return r[this.type]},_getToken:function(){var t=e.getElementsByName("csrf-token")[0];return"undefined"!=typeof t&&null!==t?t.content:null},_parseData:function(){return"JSON"===this.type?JSON.stringify(this.data):this._dataToURLEncoded()},_dataToURLEncoded:function(){var t=this.data,e=n.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])});return e.join("&")}},{request:function(t){return new u(t).init()}}})}(window,document,Object);
