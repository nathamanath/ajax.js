!function(t,n,e){"use strict";!function(t,n){var e=t.define||null;"function"==typeof e&&e.amd?e("ajax",[],function(){return n()}):t.Ajax=n()}(t,function(){var r={URLENCODED:"application/x-www-form-urlencoded",JSON:"application/json"},o=["onStart","onSuccess","onError","onFinish","onTimeout"],a=function(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e);return n}(r),i=function(e){var r=n.createElement("a");return r.href=e,r.hostname===t.location.hostname},u=function(t){return!!t.constructor.toString().match("FormData")},c=function(t){var n=new XMLHttpRequest;return"withCredentials"in n?n:i(t)?new ActiveXObject("Msxml2.XMLHTTP"):new XDomainRequest},s=function(){},f=e.keys,h={url:null,method:"GET",type:"URLENCODED",data:{},token:null,timeout:0,headers:{}};o.forEach(function(t){h[t]=s});var d=function(t,n){return f(t).forEach(function(e){n[e]=t[e]}),n},l=function(t,n){return u(t)?(f(n).forEach(function(e){t.append(e,n[e])}),t):d(n,t)},m=function(t){var n=t.querySelectorAll("input, textarea, select"),e={};return[].forEach.call(n,function(t){var n=t.name,r=t.value;n&&(e[n]=r)}),e},p=function(t){var n=this;n.url=t.url||h.url,n.method=t.method||h.method,n.type=t.type||h.type,n.token=t.token||h.token||n._getToken(),n.timeout=t.timeout||h.timeout,n.headers=d(t.headers||{},h.headers),n.data=n._prepData(t.data),o.forEach(function(e){n[e]=t[e]||h[e]})};return p.prototype={init:function(){var t=this;t._validate(),t._defaultHeaders(),t.xhr=c(t.url),t.xhr.open(t.method,t.url,!0),t.xhr.timeout=t.timeout,t._setRequestHeaders(),t._bindEvents();var n=t.xhr;return t.onStart(n),t.xhr.send(t._parseData())},_prepData:function(t){return t=t||{},t=t.constructor.toString().match("HTMLFormElement")?m(t):t,l(t,h.data)},_bindEvents:function(){var t=this,n=t.xhr;n.ontimeout=t.onTimeout,this._xDomainRequest()?(n.onload=function(){t.onSuccess(),t.onFinish()},n.onerror=function(){t.onError(),t.onFinish()}):n.onreadystatechange=function(){var n=this;4===n.readyState&&(n.status.toString().match(/2[0-9]{1,2}/)?t.onSuccess(n):t.onError(n),t.onFinish(n))}},_xDomainRequest:function(){return!!this.xhr.constructor.toString().match("XDomainRequest")},_setRequestHeaders:function(){var t=this;if(!t._xDomainRequest()){var n=t.headers;f(n).forEach(function(e){t.xhr.setRequestHeader(e,n[e])})}},_validate:function(){if(-1===a.indexOf(this.type))throw new Error("Ajax: Invalid type");if(!this.url&&!h.url)throw new Error("Ajax: URL required")},_defaultHeaders:function(){var t=this.headers,n=this.token;u(this.data)||(t["Content-Type"]=this._contentType()),n&&(t["X-CSRF-Token"]=n)},_contentType:function(){return r[this.type]},_getToken:function(){var t=n.getElementsByName("csrf-token")[0];return"undefined"!=typeof t&&null!==t?t.content:null},_parseData:function(){var t=this,n=t.data;return u(n)?n:"JSON"===t.type?JSON.stringify(n):t._dataToURLEncoded()},_dataToURLEncoded:function(){var t=this.data,n=f(t).map(function(n){return n+"="+encodeURIComponent(t[n])});return n.join("&")}},{request:function(t){return new p(t).init()},configure:function(t){return d(t,h)}}})}(window,document,Object);
