!function(t,e){"use strict";!function(t,e){var n=t.define||null;"function"==typeof n&&n.amd?n("ajax",[],function(){return e()}):t.Ajax=e()}(t,function(){var t={URLENCODED:"application/x-www-form-urlencoded",JSON:"application/json"},n=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e}(t),i=function(t){var e=new XMLHttpRequest;return"withCredentials"in e?e:t?new XDomainRequest:new ActiveXObject("Msxml2.XMLHTTP")},o=function(){},r=function(t){this.args=t,this.xhr=i(t.xDomain),this.url=t.url,this.method=t.method||"GET",this.type=t.type||n[0],this.data=t.data||{},this.token=t.token||this._getToken(),this.timeout=t.timeout||0,this.headers=t.headers||[],this.onSuccess=t.onSuccess||o,this.onError=t.onError||o,this.onStart=t.onStart||o,this.onFinish=t.onFinish||o,this.onTimeout=t.onTimeout||o};return r.prototype={init:function(){this._validate(),this._defaultHeaders(),this.xhr.open(this.method,this.url,!0),this.xhr.timeout=this.timeout,this._setRequestHeaders(),this._bindEvents();var t=this.xhr;return this.onStart(t),this.xhr.send(this._parseData())},_bindEvents:function(){var t=this,e=t.xhr;e.ontimeout=t.onTimeout,this._xDomainRequest()?(e.onload=t.onSuccess,e.onerror=t.onError):e.onreadystatechange=function(){var e=this;4===e.readyState&&(e.status.toString().match(/2[0-9]{1,2}/)?t.onSuccess(e):t.onError(e),t.onFinish(e))}},_xDomainRequest:function(){return!!this.xhr.constructor.toString().match("XDomainRequest")},_setRequestHeaders:function(){if(!this._xDomainRequest())for(var t,e=this.headers,n=0,i=e.length;i>n;n++)t=e[n],this.xhr.setRequestHeader(t.key,t.value)},_validate:function(){if(-1===n.indexOf(this.type))throw new Error("Ajax: Invalid type");if(!this.url)throw new Error("Ajax: URL required")},_defaultHeaders:function(){var t=this.headers,e=this.token;t.push({key:"Content-Type",value:this._contentType()}),e&&t.push({key:"X-CSRF-Token",value:e})},_contentType:function(){return t[this.type]},_getToken:function(){var t=e.getElementsByName("csrf-token")[0];return"undefined"!=typeof t&&null!==t?t.content:null},_parseData:function(){return"JSON"===this.type?JSON.stringify(this.data):this._dataToURLEncoded()},_dataToURLEncoded:function(){var t=this.data,e=Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])});return e.join("&")}},{request:function(t){return new r(t).init()}}})}(window,document);
